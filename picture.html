<!DOCTYPE html>
<html ondragstart="return false">
	<head>
		<meta charset="utf-8" />
		<title>旋转相册</title>
		<link rel="shortcut icon" href="10.png">
		<style>
			* {
				padding: 0px;
				margin: 0px;
				box-sizing: border-box;
			}

			body {
				background-color: #eee;
				-webkit-user-select: none;
			}

			.perspective {
				perspective: 1200px;
			}
			
			body::-webkit-scrollbar{
				display: none;
			}

			.wraper {
				width: 100px;
				position: relative;
				margin: 200px auto;
				/* border: 1px solid red; */
				transform-style: preserve-3d;
				transform: rotateX(-10deg);
			}

			.wraper img {
				width: 100px;
				position: absolute;
				display: block;
				transition: 1s;
				-webkit-box-reflect:below 5px -webkit-linear-gradient(top, rgba(0,0,255,0)30%, rgba(0,0,0,.5)100%);
			}
			
			.wraper p{
			    width: 1200px;
			    height: 1200px;
			    border-radius: 100%;
			    background: -webkit-radial-gradient(center,600px 600px,rgba(244,23,234,0.2),rgba(0,0,0,0));
			    position: absolute;
			    top: 130%;
			    left: 50%;
			    margin-left: -600px;
			    margin-top: -400px;
			    transform: rotateX(90deg);
			}
			
			#mycanvas{
				/* 切换线条方向 */
				position: fixed;
				z-index: -1;
				top: 0;
				background-color: #000000;
				background: url(images/82263899f7fac266db780bea508ad852.png) top center no-repeat;
				transform: rotateY(180deg);
			}
		</style>
	</head>
	<body >
		<div class="perspective">
			<div class="wraper" id="demo">
				<img src="images/2.jpg" alt=""><p></p>
				<img src="images/3.jpg" alt=""><p></p>
				<img src="images/4.jpg" alt=""><p></p>
				<img src="images/5.jpg" alt=""><p></p>
				<img src="images/7.jpg" alt=""><p></p>
				<img src="images/6.jpg" alt=""><p></p>
			</div>
		</div>
		<canvas id="mycanvas"></canvas>
		<script>
			var aImg = document.getElementsByTagName("img"),
			    oWrap=document.getElementById("demo"),
				len = aImg.length,
				deg = 360 / len,
				rotateX = -10,
				rotateY = 0;
			
			console.log(oWrap);
			
			window.onload = function() { //3d转换要transition有效必须要在页面加载完时改
				for (var i = 0; i < len; i++) {
					aImg[i].style.transform = "rotateY(" + i * deg + "deg) translateZ(400px)";
					aImg[i].style.transitionDelay = (len - i) * 0.1 + "s";
				}
			}


			document.onmousedown = function(e) { //鼠标按下
			
			    var oldX=e.clientX,
				    oldY=e.clientY;
				this.onmousemove = function(e) { //鼠标移动 ( e：事件对象 ) 是所必须的
				
					rotateX -= (e.clientY-oldY)*0.1;//前一次及现在的坐标差
					rotateY += (e.clientX-oldX)*0.1;
				
				oWrap.style.transform = "rotateX("+rotateX+"deg) rotateY("+rotateY+"deg)";  //叠加而不是重复
				
				oldX=e.clientX; //将这一次已经使用过的坐标赋值给旧坐标变量
				oldY=e.clientY;

				}
				this.onmouseup = function() { //松开鼠标
				this.onmousemove=null;
				}
				
			}
		</script>
		<script>
			var cwidth = window.innerWidth;
			var cheight = window.innerHeight;
			// 获取canvas元素并设置宽高
			var mycanvas = document.getElementById("mycanvas");
			
			window.onresize = function(){
				mycanvas.width = window.innerWidth;
				mycanvas.height = window.innerHeight;
				c.clearRect(0,0,cwidth,cheight); //清除旧位置的圆
			}
			mycanvas.width = window.innerWidth;
			mycanvas.height = window.innerHeight;
			
			// 创建context对象
			var c = mycanvas.getContext('2d');
			
			
			function Line(){  //线条对象构造函数
				this.width = Math.round(Math.random()*2)+1; //随机生成线宽最大为8,最小为2
				this.startx = -Math.round(Math.random()*3000); //初始x坐标
				this.starty = -Math.round(Math.random()*1600);//初始y坐标
				
				// 随机颜色
				this.color = 'rgba('+Math.floor(Math.random()*256)
				+','+Math.floor(Math.random()*256)+','+
				Math.floor(Math.random()*256)+','+Math.round(Math.random()*10)/10+')'
			}
			
			Line.prototype.draw = function(){
				
				
				
				// 绘制线条
				c.beginPath();
				c.moveTo(this.startx+400,this.starty+300);//终点,注意,顺序不能换
				c.lineTo(this.startx,this.starty);  //起点
				var gnt1 = c.createLinearGradient(this.startx,this.starty,this.startx+400,this.starty+300);//线性渐变的起止坐标
				gnt1.addColorStop(0,'transparent');//创建渐变的开始颜色，0表示偏移量，
				// 个人理解为直线上的相对位置，最大为1，一个渐变中可以写任意个渐变颜色
				gnt1.addColorStop(1,this.color);
				c.lineWidth=this.width;
				c.strokeStyle = gnt1;
				c.stroke();
			}
			
			// 一次画6条线并画出创建好的线
			
			var arr = [];
			
			for(var i = 0; i < 6; i++){
				var item = new Line();
				arr.push(item)
				item.draw()
			}
			
			let timer1 = setInterval(move,20);  //流星每20ms移动一次
			
			function move(){
				// if(Math.random() > 0.5){  //控制数量
				// // 新增流星
				// 	var item = new Line();
				// 	arr.push(item)
				// }
				c.clearRect(0,0,cwidth,cheight); //清除旧位置的圆
				arr.forEach((item,i)=>{
					item.startx += 13;
					item.starty += 10;
					if(item.starty > cheight ){
						arr.splice(i,1);
					}
					item.draw()
				})
			}
			
			// 定时器二用于更新流星数量,
			// 直接在移动函数中更新数量的话数量太多
			
			
			let timer2 = setInterval(function(){
				if(Math.random() > 0.5){  //控制数量
				// 新增流星
					var item = new Line();
					arr.push(item)
				}
			},100)
		</script>
	</body>
</html>
